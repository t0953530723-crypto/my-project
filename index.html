<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>萬用生活助手 - 敬老高清版</title>
    
    <!-- Web App 桌面化優化標籤 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="生活助手">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2563eb">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #f1f5f9; 
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            font-size: 18px; /* 全局基礎字體放大 */
        }
        /* 讓輸入框可以選取與輸入 */
        input, textarea { -webkit-user-select: text; user-select: text; }
        
        .tab-active { border-bottom: 5px solid #2563eb; color: #1e40af; background-color: #f8fafc; }
        .sub-tab-active { background-color: #2563eb; color: white; box-shadow: 0 6px 15px -3px rgba(37, 99, 235, 0.4); }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .fortune-card { background: linear-gradient(135deg, #fffaf0 0%, #fff5e6 100%); border: 2px solid #fbbf24; }
        .calendar-day { min-height: 60px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* 長輩版專屬大按鈕 */
        .btn-large { padding: 18px; border-radius: 20px; font-size: 20px; font-weight: 900; transition: all 0.2s; }
        
        /* 強化刪除按鈕視覺 - 字體加大 */
        .btn-delete { color: #dc2626; font-weight: 900; background-color: #fee2e2; border: 2px solid #fecaca; padding: 6px 16px; border-radius: 12px; font-size: 16px; }
        .btn-delete:active { background-color: #fecaca; transform: scale(0.95); }
        
        /* 強化時間標籤 - 更清晰 */
        .time-tag { color: #1f2937; font-weight: 700; background-color: #e5e7eb; padding: 4px 10px; border-radius: 8px; font-size: 14px; border: 1.5px solid #d1d5db; }

        /* 內容字體強化 */
        .content-text { font-size: 20px; line-height: 1.6; font-weight: 700; color: #111827; }
        .contact-name { font-size: 24px; font-weight: 900; color: #000; }
        .contact-phone { font-size: 22px; font-weight: 800; color: #2563eb; }
    </style>
</head>
<body class="p-2 md:p-4 flex flex-col justify-start items-center min-h-screen">

    <div class="max-w-[480px] w-full bg-white rounded-[3rem] shadow-2xl overflow-hidden relative border-4 border-gray-200">
        <!-- Header - 更顯眼 -->
        <div class="bg-gradient-to-br from-blue-700 to-indigo-800 p-8 text-white text-center">
            <div id="clock" class="text-6xl font-black font-mono mb-2 tracking-tighter">00:00:00</div>
            <div id="date-display" class="text-xl font-bold mb-1">系統讀取中...</div>
            <div id="lunar-display-top" class="text-lg text-yellow-300 font-bold">農曆讀取中...</div>
        </div>

        <!-- 主導覽 - 文字加大 -->
        <nav class="flex border-b-2 bg-gray-50">
            <button onclick="switchTab('calendar')" id="tab-calendar" class="flex-1 py-5 text-lg font-black tab-active">日曆運勢</button>
            <button onclick="switchTab('memo')" id="tab-memo" class="flex-1 py-5 text-lg font-black text-gray-500">生活備忘</button>
            <button onclick="switchTab('contacts')" id="tab-contacts" class="flex-1 py-5 text-lg font-black text-gray-500">電話簿</button>
        </nav>

        <main class="p-6 min-h-[550px] bg-white">
            <!-- 日曆區塊 -->
            <section id="section-calendar" class="space-y-6 animate-fade-in">
                <div class="flex justify-center items-center">
                    <h2 class="text-2xl font-black text-blue-900 bg-blue-50 px-6 py-2 rounded-full" id="calendar-month">讀取中...</h2>
                </div>
                <div class="bg-white rounded-3xl p-4 border-2 border-gray-200 shadow-inner">
                    <div class="grid grid-cols-7 gap-1 text-center mb-3">
                        <div class="text-sm font-black text-red-500">日</div>
                        <div class="text-sm font-black text-gray-600">一</div>
                        <div class="text-sm font-black text-gray-600">二</div>
                        <div class="text-sm font-black text-gray-600">三</div>
                        <div class="text-sm font-black text-gray-600">四</div>
                        <div class="text-sm font-black text-gray-600">五</div>
                        <div class="text-sm font-black text-gray-800">六</div>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-2 text-center"></div>
                </div>
                <!-- 運勢卡片 - 高對比度 -->
                <div class="fortune-card rounded-3xl p-6 space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-red-700 font-black text-xl">今日運勢</span>
                        <span class="text-sm px-3 py-1 bg-red-600 text-white rounded-lg font-bold">指引</span>
                    </div>
                    <div id="fortune-text" class="text-gray-900 text-xl leading-relaxed font-black">正在為您求籤...</div>
                    <div class="grid grid-cols-2 gap-3 mt-2">
                        <div class="bg-white p-3 rounded-2xl border-2 border-green-200">
                            <span class="text-sm text-green-700 font-black block mb-1">【宜】</span>
                            <span id="fortune-suit" class="text-base text-gray-900 font-bold">讀書、會友</span>
                        </div>
                        <div class="bg-white p-3 rounded-2xl border-2 border-red-200">
                            <span class="text-sm text-red-700 font-black block mb-1">【忌】</span>
                            <span id="fortune-avoid" class="text-base text-gray-900 font-bold">爭執、遠行</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 生活備忘錄區塊 -->
            <section id="section-memo" class="hidden space-y-6 animate-fade-in">
                <div class="flex bg-gray-200 p-1.5 rounded-2xl">
                    <button onclick="switchSubTab('memo', 'edit')" id="memo-sub-edit" class="flex-1 py-3 text-lg font-black rounded-xl sub-tab-active">新增內容</button>
                    <button onclick="switchSubTab('memo', 'view')" id="memo-sub-view" class="flex-1 py-3 text-lg font-black rounded-xl text-gray-600">查看紀錄</button>
                </div>
                <div id="memo-view-edit">
                    <textarea id="memo-input" placeholder="在這裡寫字，會自動保存..." rows="6" class="w-full p-5 bg-gray-50 rounded-3xl border-2 border-gray-200 text-xl font-bold outline-none resize-none mb-6 focus:border-blue-500"></textarea>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="clearMemoInput()" class="bg-gray-200 text-gray-700 btn-large active:scale-95">清除內容</button>
                        <button onclick="saveMemo()" class="bg-blue-600 text-white btn-large active:scale-95 shadow-lg">儲存起來</button>
                    </div>
                </div>
                <div id="memo-view-view" class="hidden">
                    <div id="memo-list" class="space-y-5"></div>
                </div>
            </section>

            <!-- 個人電話簿區塊 -->
            <section id="section-contacts" class="hidden space-y-6 animate-fade-in">
                <div class="flex bg-gray-200 p-1.5 rounded-2xl">
                    <button onclick="switchSubTab('contacts', 'edit')" id="contacts-sub-edit" class="flex-1 py-3 text-lg font-black rounded-xl sub-tab-active">新增電話</button>
                    <button onclick="switchSubTab('contacts', 'view')" id="contacts-sub-view" class="flex-1 py-3 text-lg font-black rounded-xl text-gray-600">我的聯絡人</button>
                </div>
                <div id="contacts-view-edit" class="space-y-5">
                    <div class="space-y-2">
                        <label class="font-black text-gray-700 ml-2">姓名：</label>
                        <input type="text" id="contact-name" placeholder="請輸入姓名" class="w-full p-5 bg-gray-50 rounded-2xl border-2 border-gray-200 text-xl font-bold outline-none focus:border-indigo-500">
                    </div>
                    <div class="space-y-2">
                        <label class="font-black text-gray-700 ml-2">電話：</label>
                        <input type="tel" id="contact-phone" placeholder="請輸入電話號碼" class="w-full p-5 bg-gray-50 rounded-2xl border-2 border-gray-200 text-xl font-bold outline-none focus:border-indigo-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="clearContactInput()" class="bg-gray-200 text-gray-700 btn-large active:scale-95">清除</button>
                        <button onclick="saveContact()" class="bg-indigo-700 text-white btn-large active:scale-95 shadow-lg">儲存電話</button>
                    </div>
                </div>
                <div id="contacts-view-view" class="hidden">
                    <div id="contacts-list" class="space-y-4"></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- 核心變數 ---
        const MEMO_KEY = 'my_assistant_memos';
        const CONTACTS_KEY = 'my_assistant_contacts';

        // --- 全域 UI 切換 ---
        window.switchTab = (tab) => {
            const sections = ['calendar', 'memo', 'contacts'];
            sections.forEach(t => {
                const el = document.getElementById(`section-${t}`);
                const tabBtn = document.getElementById(`tab-${t}`);
                if (el) el.classList.add('hidden');
                if (tabBtn) {
                    tabBtn.classList.remove('tab-active');
                    tabBtn.classList.add('text-gray-500');
                }
            });
            const targetEl = document.getElementById(`section-${tab}`);
            const targetBtn = document.getElementById(`tab-${tab}`);
            if (targetEl) targetEl.classList.remove('hidden');
            if (targetBtn) {
                targetBtn.classList.add('tab-active');
                targetBtn.classList.remove('text-gray-500');
            }
        };

        window.switchSubTab = (p, v) => {
            const eBtn = document.getElementById(`${p}-sub-edit`), vBtn = document.getElementById(`${p}-sub-view`);
            const eA = document.getElementById(`${p}-view-edit`), vA = document.getElementById(`${p}-view-view`);
            if (!eBtn || !vBtn || !eA || !vA) return;

            if (v === 'edit') {
                eBtn.className = "flex-1 py-3 text-lg font-black rounded-xl sub-tab-active";
                vBtn.className = "flex-1 py-3 text-lg font-black rounded-xl text-gray-600";
                eA.classList.remove('hidden'); vA.classList.add('hidden');
            } else {
                vBtn.className = "flex-1 py-3 text-lg font-black rounded-xl sub-tab-active";
                eBtn.className = "flex-1 py-3 text-lg font-black rounded-xl text-gray-600";
                eA.classList.add('hidden'); vA.classList.remove('hidden');
                if(p === 'memo') renderMemos();
                if(p === 'contacts') renderContacts();
            }
        };

        // --- 清空功能 ---
        window.clearMemoInput = () => document.getElementById('memo-input').value = "";
        window.clearContactInput = () => {
            document.getElementById('contact-name').value = "";
            document.getElementById('contact-phone').value = "";
        };

        // --- 農曆算法 ---
        const lunarMonths = ["正月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "冬月", "臘月"];
        const lunarDays = ["初一", "初二", "初三", "初四", "初五", "初六", "初七", "初八", "初九", "初十", "十一", "十二", "十三", "十四", "十五", "十六", "十七", "十八", "十九", "廿十", "廿一", "廿二", "廿三", "廿四", "廿五", "廿六", "廿七", "廿八", "廿九", "三十"];
        
        function calculateLunar(year, month, day) {
            try {
                const baseDate = new Date(2024, 1, 10);
                const targetDate = new Date(year, month, day);
                const diffDays = Math.floor((targetDate - baseDate) / (24 * 3600 * 1000));
                let cycleDays = diffDays % 354; 
                if (cycleDays < 0) cycleDays += 354;
                return { month: lunarMonths[Math.floor(cycleDays / 29.5) % 12], day: lunarDays[Math.floor(cycleDays % 29.5) % 30] };
            } catch(e) {
                return { month: "正月", day: "初一" };
            }
        }

        // --- 生活備忘錄邏輯 ---
        window.saveMemo = () => {
            const input = document.getElementById('memo-input');
            const text = input.value.trim();
            if (!text) return;
            const memos = JSON.parse(localStorage.getItem(MEMO_KEY) || '[]');
            memos.unshift({ id: Date.now(), text, time: new Date().toLocaleString('zh-TW', { hour12: false }) });
            localStorage.setItem(MEMO_KEY, JSON.stringify(memos));
            input.value = "";
            switchSubTab('memo', 'view');
        };

        function renderMemos() {
            const list = document.getElementById('memo-list');
            const memos = JSON.parse(localStorage.getItem(MEMO_KEY) || '[]');
            list.innerHTML = memos.map(m => `
                <div class="p-6 bg-white rounded-3xl border-4 border-blue-50 shadow-md animate-fade-in">
                    <p class="content-text mb-6 whitespace-pre-wrap">${m.text}</p>
                    <div class="flex justify-between items-center pt-4 border-t-2 border-gray-100">
                        <span class="time-tag">日期：${m.time}</span>
                        <button onclick="deleteItem('memo', ${m.id})" class="btn-delete">刪除內容</button>
                    </div>
                </div>
            `).join('') || '<div class="py-20 text-center text-gray-400 text-xl font-black">目前還沒寫任何內容</div>';
        }

        // --- 個人電話簿邏輯 ---
        window.saveContact = () => {
            const nInput = document.getElementById('contact-name');
            const pInput = document.getElementById('contact-phone');
            const name = nInput.value.trim();
            const phone = pInput.value.trim();
            if (!name || !phone) return;
            const contacts = JSON.parse(localStorage.getItem(CONTACTS_KEY) || '[]');
            contacts.unshift({ id: Date.now(), name, phone });
            localStorage.setItem(CONTACTS_KEY, JSON.stringify(contacts));
            nInput.value = ""; pInput.value = "";
            switchSubTab('contacts', 'view');
        };

        function renderContacts() {
            const list = document.getElementById('contacts-list');
            const contacts = JSON.parse(localStorage.getItem(CONTACTS_KEY) || '[]');
            list.innerHTML = contacts.map(c => `
                <div class="flex justify-between items-center p-6 bg-blue-50/50 rounded-3xl border-4 border-blue-100 shadow-sm animate-fade-in">
                    <div>
                        <div class="contact-name">${c.name}</div>
                        <div class="contact-phone mt-1 tracking-wider">${c.phone}</div>
                    </div>
                    <button onclick="deleteItem('contact', ${c.id})" class="btn-delete">刪除</button>
                </div>
            `).join('') || '<div class="py-20 text-center text-gray-400 text-xl font-black">電話簿目前空空的</div>';
        }

        // --- 刪除功能 ---
        window.deleteItem = (type, id) => {
            if (!confirm("確定要刪除嗎？刪掉後找不回來喔！")) return;
            const key = type === 'memo' ? MEMO_KEY : CONTACTS_KEY;
            let items = JSON.parse(localStorage.getItem(key) || '[]');
            items = items.filter(i => i.id !== id);
            localStorage.setItem(key, JSON.stringify(items));
            type === 'memo' ? renderMemos() : renderContacts();
        };

        // --- 核心初始化函式 ---
        window.onload = function() {
            const now = new Date();
            const y = now.getFullYear(), m = now.getMonth(), d = now.getDate();
            
            const clockEl = document.getElementById('clock');
            const updateClock = () => { 
                if(clockEl) clockEl.textContent = new Date().toTimeString().split(' ')[0]; 
            };
            setInterval(updateClock, 1000);
            updateClock();

            document.getElementById('date-display').textContent = now.toLocaleDateString('zh-TW', { weekday: 'long', month: 'long', day: 'numeric' });
            const lun = calculateLunar(y, m, d);
            document.getElementById('lunar-display-top').textContent = `農曆 ${lun.month}${lun.day}`;
            document.getElementById('calendar-month').textContent = `${y}年 ${m + 1}月`;

            const grid = document.getElementById('calendar-grid');
            if(grid) {
                const firstDay = new Date(y, m, 1).getDay();
                const totalDays = new Date(y, m + 1, 0).getDate();
                let html = "";
                for (let i = 0; i < firstDay; i++) html += `<div></div>`;
                for (let i = 1; i <= totalDays; i++) {
                    const l = calculateLunar(y, m, i);
                    const isToday = i === d;
                    const activeClass = isToday ? 'bg-blue-700 text-white rounded-2xl shadow-xl scale-110 z-10 border-2 border-white' : 'text-gray-900 border border-gray-100';
                    html += `
                        <div class="calendar-day ${activeClass} transition-all">
                            <span class="text-lg font-black">${i}</span>
                            <span class="text-[10px] ${isToday ? 'text-blue-100' : 'text-blue-600'} font-bold">${l.day}</span>
                        </div>
                    `;
                }
                grid.innerHTML = html;
            }

            const fortunes = ["宜保持愉快心情。", "適合去公園散散步。", "整理房間，迎接福氣。", "打個電話跟老友聊聊。", "適合吃點營養好吃的。"];
            document.getElementById('fortune-text').textContent = fortunes[d % fortunes.length];
            
            renderMemos();
            renderContacts();
        };
    </script>
</body>
</html>
