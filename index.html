<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¬ç”¨ç”Ÿæ´»åŠ©æ‰‹ - èˆ’è¦–è­·çœ¼ç‰ˆ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&display=swap');
        
        /* æ¡ç”¨æ¨¡æ“¬ç´™å¼µè³ªæ„Ÿçš„æš–ç°è‰²èƒŒæ™¯ï¼Œæ¥µè‡´è­·çœ¼ */
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #f0f0eb; 
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            font-size: 24px;
            color: #1a202c;
        }
        
        .tab-active { 
            border-bottom: 8px solid #1e3a8a; 
            color: #1e3a8a; 
            background-color: #fdfdfb; 
        }
        
        /* æ—¥æ›†æ ¼æ¨£å¼ */
        .calendar-day { 
            min-height: 130px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start; 
            padding: 12px 2px;
            cursor: pointer; 
            position: relative; 
            border-radius: 20px; 
            transition: all 0.2s ease;
            background-color: #fcfcf9;
            border: 1px solid #dcdcdc;
        }
        
        .day-number { 
            font-size: 38px; 
            font-weight: 900; 
            line-height: 1; 
            margin-bottom: 6px; 
            color: #111827; 
        }
        .is-weekend .day-number { color: #c2410c; }
        .lunar-text { font-size: 16px; font-weight: 700; color: #71717a; }

        .holiday-tag { 
            font-size: 14px; 
            color: #ffffff; 
            font-weight: 900; 
            background-color: #9f1239; 
            padding: 4px 8px;
            border-radius: 8px;
            margin-top: 6px;
            text-align: center;
            width: 92%;
            white-space: nowrap;
            overflow: hidden;
        }
        
        .today-mark { 
            background-color: #fef3c7 !important; 
            border: 5px solid #d97706 !important; 
        }

        .selected-day:not(.today-mark) { 
            background-color: #eff6ff; 
            border: 4px solid #1d4ed8; 
        }

        /* å·¦å³ç®­é ­å°èˆªæŒ‰éˆ• */
        .btn-nav { 
            background-color: #fcfcf9; 
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 28px; 
            font-size: 40px; 
            border: 3px solid #cbd5e1; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
            color: #1e3a8a;
        }
        
        .event-dot { 
            width: 12px; 
            height: 12px; 
            background-color: #2563eb; 
            border-radius: 50%; 
            margin-top: 8px; 
            border: 2px solid white;
        }
        
        .card { 
            background: #fcfcf9; 
            border-radius: 2.5rem; 
            padding: 2rem; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); 
            border: 2px solid #e2e8f0; 
        }
        
        .input-box { 
            background: #fdfdfb; 
            border: 4px solid #cbd5e1; 
            border-radius: 2rem; 
            padding: 1.2rem; 
            font-size: 1.8rem; 
            font-weight: bold; 
            width: 100%; 
        }
    </style>
</head>
<body class="p-2 md:p-6 flex flex-col items-center min-h-screen">

    <div class="max-w-[550px] w-full bg-[#fdfdfb] rounded-[4rem] shadow-2xl overflow-hidden border-8 border-white">
        <!-- ä¸Šæ–¹ï¼šæŸ”å’Œæ·±è—è‰²æ™‚é–“å€ -->
        <div class="bg-[#1e293b] p-10 text-white text-center">
            <div id="clock" class="text-7xl font-black font-mono mb-4 tracking-tighter text-[#fbbf24]">00:00:00</div>
            <div id="date-now" class="text-3xl font-bold">...</div>
            <div id="lunar-now" class="text-2xl text-blue-200 font-bold mt-2">...</div>
        </div>

        <!-- å°èˆªåˆ‡æ› -->
        <nav class="flex border-b-8 border-[#f0f0eb] bg-[#f8f8f4]">
            <button onclick="switchTab('calendar')" id="tab-calendar" class="flex-1 py-8 text-2xl font-black tab-active">çœ‹æ—¥æ›†</button>
            <button onclick="switchTab('contacts')" id="tab-contacts" class="flex-1 py-8 text-2xl font-black text-gray-400">é›»è©±ç°¿</button>
            <button onclick="switchTab('memo')" id="tab-memo" class="flex-1 py-8 text-2xl font-black text-gray-400">è¨˜äº‹æœ¬</button>
        </nav>

        <main class="p-6 bg-[#fdfdfb] min-h-[700px]">
            <!-- æ—¥æ›†å€ -->
            <section id="section-calendar" class="space-y-8">
                <div class="flex justify-between items-center px-2">
                    <button onclick="changeMonth(-1)" class="btn-nav">â¬…ï¸</button>
                    <h2 class="text-4xl font-black text-slate-800" id="calendar-month">...</h2>
                    <button onclick="changeMonth(1)" class="btn-nav">â¡ï¸</button>
                </div>

                <div class="grid grid-cols-7 gap-2 text-center mb-2">
                    <div class="py-2 text-xl font-black text-orange-700">æ—¥</div>
                    <div class="py-2 text-xl font-black text-slate-400">ä¸€</div>
                    <div class="py-2 text-xl font-black text-slate-400">äºŒ</div>
                    <div class="py-2 text-xl font-black text-slate-400">ä¸‰</div>
                    <div class="py-2 text-xl font-black text-slate-400">å››</div>
                    <div class="py-2 text-xl font-black text-slate-400">äº”</div>
                    <div class="py-2 text-xl font-black text-blue-800">å…­</div>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-2"></div>

                <div id="selected-info" class="card">
                    <div id="selected-date-title" class="text-slate-900 font-black text-3xl border-b-4 border-slate-100 pb-3 mb-6">é»é¸æ—¥æœŸçœ‹è©³ç´°</div>
                    <div id="selected-date-events" class="space-y-4 text-2xl font-bold"></div>
                </div>
            </section>

            <!-- é›»è©±ç°¿å€ï¼šå·²ç§»é™¤æ’¥è™ŸåŠŸèƒ½ -->
            <section id="section-contacts" class="hidden space-y-6">
                <div class="space-y-4">
                    <input id="contact-name" placeholder="å§“å (å¦‚ï¼šäºŒå¥³å…’)" class="input-box">
                    <input id="contact-phone" placeholder="é›»è©± (åƒ…ä¾›è¨˜éŒ„)" class="input-box" type="tel">
                </div>
                <button onclick="addContact()" class="w-full bg-green-800 text-white p-6 rounded-3xl text-3xl font-black shadow-xl">å­˜å…¥è¨˜äº‹</button>
                
                <div class="bg-amber-50 border-2 border-amber-200 p-4 rounded-2xl text-amber-800 text-lg font-bold">
                    ğŸ’¡ æç¤ºï¼šæ­¤è™•åƒ…æä¾›è³‡æ–™æŸ¥è©¢ï¼Œç„¡æ³•ç›´æ¥æ’¥æ‰“é›»è©±ï¼Œé˜²æ­¢èª¤è§¸ã€‚
                </div>

                <div id="contact-list" class="space-y-4 pt-4"></div>
            </section>

            <!-- è¨˜äº‹æœ¬å€ -->
            <section id="section-memo" class="hidden space-y-6">
                <div class="space-y-4">
                    <label class="text-2xl font-black block">1. é¸æ“‡æ—¥å­ï¼š</label>
                    <input type="date" id="memo-date" class="input-box">
                    <label class="text-2xl font-black block">2. å¯«ä¸‹è¦åšçš„äº‹ï¼š</label>
                    <textarea id="memo-input" placeholder="ä¾‹å¦‚ï¼šä¸‹åˆä¸‰é»å»æ‰“çƒ..." rows="2" class="input-box"></textarea>
                </div>
                <button onclick="saveMemo()" class="w-full bg-blue-800 text-white p-6 rounded-3xl text-3xl font-black shadow-xl">å„²å­˜è¨˜äº‹</button>
                
                <div class="pt-8 border-t-4 border-slate-100">
                    <h3 class="text-2xl font-black text-slate-600 mb-6">ğŸ“‹ æˆ‘çš„æ¸…å–®</h3>
                    <div id="memo-list" class="space-y-4"></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const MEMO_KEY = 'v7_memos_soft';
        const CONTACT_KEY = 'v7_contacts_soft';
        let currentMonthDate = new Date(); 
        let selectedDate = new Date();

        const SOLAR_HOLIDAYS = {
            "1-1": "å…ƒæ—¦", "2-28": "å’Œå¹³ç´€å¿µæ—¥", "4-4": "å…’ç«¥ç¯€", "4-5": "æ¸…æ˜ç¯€",
            "5-1": "å‹å‹•ç¯€", "8-8": "çˆ¶è¦ªç¯€", "9-28": "æ•™å¸«ç¯€", "10-10": "åœ‹æ…¶æ—¥"
        };

        function getLunarInfo(y, m, d) {
            const baseDate = new Date(2026, 1, 17);
            const targetDate = new Date(y, m, d);
            const diffDays = Math.floor((targetDate - baseDate) / (1000 * 60 * 60 * 24));
            const lunarCycle = 29.53059;
            const totalLunarMonths = diffDays / lunarCycle;
            const dayOfLunarMonth = Math.floor((totalLunarMonths - Math.floor(totalLunarMonths)) * lunarCycle) + 1;
            const lunarMonth = (Math.floor(totalLunarMonths) % 12 + 1 + 12) % 12 || 12;

            const lunarNames = ["åˆä¸€", "åˆäºŒ", "åˆä¸‰", "åˆå››", "åˆäº”", "åˆå…­", "åˆä¸ƒ", "åˆå…«", "åˆä¹", "åˆå", "åä¸€", "åäºŒ", "åä¸‰", "åå››", "åäº”", "åå…­", "åä¸ƒ", "åå…«", "åä¹", "å»¿å", "å»¿ä¸€", "å»¿äºŒ", "å»¿ä¸‰", "å»¿å››", "å»¿äº”", "å»¿å…­", "å»¿ä¸ƒ", "å»¿å…«", "å»¿ä¹", "ä¸‰å"];
            
            let holidayName = SOLAR_HOLIDAYS[`${m+1}-${d}`] || "";
            if (lunarMonth === 1 && dayOfLunarMonth === 1) holidayName = "æ˜¥ç¯€";
            else if (lunarMonth === 1 && dayOfLunarMonth === 2) holidayName = "åˆäºŒ";
            else if (lunarMonth === 1 && dayOfLunarMonth === 3) holidayName = "åˆä¸‰";
            else if (lunarMonth === 1 && dayOfLunarMonth === 15) holidayName = "å…ƒå®µç¯€";
            else if (lunarMonth === 5 && dayOfLunarMonth === 5) holidayName = "ç«¯åˆç¯€";
            else if (lunarMonth === 8 && dayOfLunarMonth === 15) holidayName = "ä¸­ç§‹ç¯€";
            else if (lunarMonth === 9 && dayOfLunarMonth === 9) holidayName = "é‡é™½ç¯€";
            else if (lunarMonth === 12 && dayOfLunarMonth >= 29) holidayName = "é™¤å¤•";

            return { text: lunarNames[dayOfLunarMonth - 1] || "åˆä¸€", holiday: holidayName };
        }

        function renderCalendar() {
            const y = currentMonthDate.getFullYear(), m = currentMonthDate.getMonth();
            const today = new Date();
            document.getElementById('calendar-month').textContent = `${y}å¹´ ${m + 1}æœˆ`;
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = "";
            const firstDay = new Date(y, m, 1).getDay();
            const totalDays = new Date(y, m + 1, 0).getDate();
            for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement('div'));
            const memos = JSON.parse(localStorage.getItem(MEMO_KEY) || '[]');
            for (let i = 1; i <= totalDays; i++) {
                const dateKeyStr = `${y}-${(m+1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                const dayOfWeek = new Date(y, m, i).getDay();
                const isToday = today.getFullYear() === y && today.getMonth() === m && today.getDate() === i;
                const isSelected = selectedDate.getFullYear() === y && selectedDate.getMonth() === m && selectedDate.getDate() === i;
                const lunar = getLunarInfo(y, m, i);
                const hasMemo = memos.some(memo => memo.date === dateKeyStr);
                const dayEl = document.createElement('div');
                dayEl.className = `calendar-day ${dayOfWeek === 0 || dayOfWeek === 6 ? 'is-weekend' : ''} ${isToday ? 'today-mark' : ''} ${isSelected ? 'selected-day' : ''}`;
                dayEl.onclick = () => selectDay(y, m, i);
                dayEl.innerHTML = `
                    <span class="day-number">${i}</span>
                    <span class="lunar-text">${lunar.text}</span>
                    ${lunar.holiday ? `<span class="holiday-tag">${lunar.holiday}</span>` : ''}
                    ${hasMemo ? `<div class="event-dot"></div>` : ''}
                `;
                grid.appendChild(dayEl);
            }
        }

        function selectDay(y, m, d) {
            selectedDate = new Date(y, m, d);
            renderCalendar();
            updateDetails();
        }

        function updateDetails() {
            const y = selectedDate.getFullYear(), m = selectedDate.getMonth(), d = selectedDate.getDate();
            const dateKeyStr = `${y}-${(m+1).toString().padStart(2, '0')}-${d.toString().padStart(2, '0')}`;
            const lunar = getLunarInfo(y, m, d);
            document.getElementById('selected-date-title').textContent = `${m+1}æœˆ${d}æ—¥ (${lunar.text})`;
            let html = "";
            if (lunar.holiday) html += `<div class="bg-red-800 text-white p-5 rounded-2xl text-center shadow-md">ğŸš© ç¯€æ…¶ï¼š${lunar.holiday}</div>`;
            const memos = JSON.parse(localStorage.getItem(MEMO_KEY) || '[]');
            const dayMemos = memos.filter(x => x.date === dateKeyStr);
            if (dayMemos.length > 0) {
                dayMemos.forEach(m => {
                    html += `<div class="bg-white p-6 rounded-3xl border-l-[12px] border-blue-600 shadow-lg flex justify-between items-center">
                        <span class="text-3xl">ğŸ“ ${m.text}</span>
                        <button onclick="deleteMemo(${m.id})" class="text-red-400 p-2 text-2xl">âŒ</button>
                    </div>`;
                });
            } else if (!lunar.holiday) {
                html += `<div class="text-slate-400 italic text-center py-8">é€™å¤©æ²’æœ‰è¨˜äº‹ã€‚</div>`;
            }
            document.getElementById('selected-date-events').innerHTML = html;
        }

        function addContact() {
            const name = document.getElementById('contact-name').value.trim();
            const phone = document.getElementById('contact-phone').value.trim();
            if (!name || !phone) return;
            const contacts = JSON.parse(localStorage.getItem(CONTACT_KEY) || '[]');
            contacts.push({ id: Date.now(), name, phone });
            localStorage.setItem(CONTACT_KEY, JSON.stringify(contacts));
            document.getElementById('contact-name').value = "";
            document.getElementById('contact-phone').value = "";
            renderContacts();
        }

        function renderContacts() {
            const list = document.getElementById('contact-list');
            const contacts = JSON.parse(localStorage.getItem(CONTACT_KEY) || '[]');
            // å·²ä¿®æ”¹ï¼šç§»é™¤ <a> æ¨™ç±¤æ’¥è™Ÿé€£çµï¼Œåƒ…ä¿ç•™ç´”æ–‡å­—èˆ‡åˆªé™¤åŠŸèƒ½
            list.innerHTML = contacts.map(c => `
                <div class="bg-white p-8 rounded-[2.5rem] border-2 border-slate-100 shadow flex justify-between items-center">
                    <div>
                        <div class="text-4xl font-black mb-1">${c.name}</div>
                        <div class="text-slate-600 text-2xl font-bold font-mono">${c.phone}</div>
                    </div>
                    <button onclick="deleteContact(${c.id})" class="bg-slate-100 p-6 rounded-full text-3xl">ğŸ—‘ï¸</button>
                </div>
            `).join('') || '<div class="text-center text-slate-400 py-20">é›»è©±ç°¿ç›®å‰ç©ºçš„</div>';
        }

        function deleteContact(id) {
            let contacts = JSON.parse(localStorage.getItem(CONTACT_KEY) || '[]');
            contacts = contacts.filter(c => c.id !== id);
            localStorage.setItem(CONTACT_KEY, JSON.stringify(contacts));
            renderContacts();
        }

        function saveMemo() {
            const dateInput = document.getElementById('memo-date');
            const textInput = document.getElementById('memo-input');
            if (!dateInput.value || !textInput.value.trim()) return;
            const memos = JSON.parse(localStorage.getItem(MEMO_KEY) || '[]');
            memos.unshift({ id: Date.now(), text: textInput.value, date: dateInput.value });
            localStorage.setItem(MEMO_KEY, JSON.stringify(memos));
            textInput.value = "";
            renderCalendar(); updateDetails(); renderMemoList();
            switchTab('calendar');
        }

        function renderMemoList() {
            const list = document.getElementById('memo-list');
            const memos = JSON.parse(localStorage.getItem(MEMO_KEY) || '[]');
            list.innerHTML = memos.map(m => `
                <div class="bg-white p-6 rounded-[2rem] border-2 border-slate-100 shadow mb-4">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-blue-800 font-black text-2xl">ğŸ“… ${m.date}</div>
                        <button onclick="deleteMemo(${m.id})" class="text-red-500 font-black text-xl">åˆªé™¤</button>
                    </div>
                    <div class="text-3xl font-bold text-slate-800">${m.text}</div>
                </div>
            `).join('') || '<div class="text-center text-slate-400 py-20">ç›®å‰æ²’è¨˜äº‹</div>';
        }

        function deleteMemo(id) {
            let memos = JSON.parse(localStorage.getItem(MEMO_KEY) || '[]');
            memos = memos.filter(m => m.id !== id);
            localStorage.setItem(MEMO_KEY, JSON.stringify(memos));
            renderCalendar(); updateDetails(); renderMemoList();
        }

        window.switchTab = (tab) => {
            document.getElementById('section-calendar').classList.toggle('hidden', tab !== 'calendar');
            document.getElementById('section-contacts').classList.toggle('hidden', tab !== 'contacts');
            document.getElementById('section-memo').classList.toggle('hidden', tab !== 'memo');
            document.getElementById('tab-calendar').className = `flex-1 py-8 text-2xl font-black ${tab === 'calendar' ? 'tab-active' : 'text-gray-400'}`;
            document.getElementById('tab-contacts').className = `flex-1 py-8 text-2xl font-black ${tab === 'contacts' ? 'tab-active' : 'text-gray-400'}`;
            document.getElementById('tab-memo').className = `flex-1 py-8 text-2xl font-black ${tab === 'memo' ? 'tab-active' : 'text-gray-400'}`;
            if(tab === 'contacts') renderContacts();
            if(tab === 'memo') renderMemoList();
        };

        window.changeMonth = (dir) => {
            currentMonthDate.setMonth(currentMonthDate.getMonth() + dir);
            renderCalendar();
        };

        window.onload = function() {
            setInterval(() => {
                const now = new Date();
                const h = now.getHours().toString().padStart(2, '0');
                const m = now.getMinutes().toString().padStart(2, '0');
                const s = now.getSeconds().toString().padStart(2, '0');
                document.getElementById('clock').textContent = `${h}:${m}:${s}`;
            }, 1000);
            
            const now = new Date();
            document.getElementById('date-now').textContent = now.toLocaleDateString('zh-TW', { year:'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            const lun = getLunarInfo(now.getFullYear(), now.getMonth(), now.getDate());
            document.getElementById('lunar-now').textContent = `è¾²æ›† ${lun.text}`;
            renderCalendar();
            updateDetails();
        };
    </script>
</body>
</html>
