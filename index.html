<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>萬用生活助手 - 正式版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; }
        .sub-tab-active { background-color: #3b82f6; color: white; box-shadow: 0 4px 10px -2px rgba(59, 130, 246, 0.4); }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .fortune-card { background: linear-gradient(135deg, #fff5f5 0%, #fff0f0 100%); border: 1px solid #fee2e2; }
        .calendar-day { min-height: 50px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        /* 強化刪除按鈕視覺 */
        .btn-delete { color: #ef4444; font-weight: 800; background-color: #fef2f2; border: 1px solid #fee2e2; padding: 4px 12px; border-radius: 8px; font-size: 12px; transition: all 0.2s; }
        .btn-delete:active { background-color: #fee2e2; transform: scale(0.95); }
        /* 強化時間標籤 */
        .time-tag { color: #374151; font-weight: 600; background-color: #f3f4f6; padding: 2px 8px; border-radius: 6px; font-size: 11px; border: 1px solid #e5e7eb; }
    </style>
</head>
<body class="p-4 flex flex-col justify-start items-center min-h-screen">

    <div class="max-w-[450px] w-full bg-white rounded-[2.5rem] shadow-2xl overflow-hidden relative">
        <!-- Header -->
        <div class="bg-gradient-to-br from-blue-600 to-violet-700 p-8 text-white text-center">
            <div id="clock" class="text-5xl font-bold font-mono mb-2">00:00:00</div>
            <div id="date-display" class="text-sm opacity-80 font-medium">系統讀取中...</div>
            <div id="lunar-display-top" class="text-xs mt-1 text-yellow-200">農曆讀取中...</div>
            <div id="storage-status" class="mt-4 text-[10px] opacity-60 bg-black/20 py-1 px-3 rounded-full inline-block">本地儲存模式</div>
        </div>

        <!-- 主導覽 -->
        <nav class="flex border-b bg-gray-50/50">
            <button onclick="switchTab('calendar')" id="tab-calendar" class="flex-1 py-4 text-sm font-bold tab-active">日曆運勢</button>
            <button onclick="switchTab('memo')" id="tab-memo" class="flex-1 py-4 text-sm font-bold text-gray-400">生活備忘錄</button>
            <button onclick="switchTab('contacts')" id="tab-contacts" class="flex-1 py-4 text-sm font-bold text-gray-400">個人電話簿</button>
        </nav>

        <main class="p-6 min-h-[500px] bg-white">
            <!-- 日曆區塊 -->
            <section id="section-calendar" class="space-y-6 animate-fade-in">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-black text-gray-800" id="calendar-month">讀取中...</h2>
                </div>
                <div class="bg-gray-50 rounded-3xl p-4 border border-gray-100">
                    <div class="grid grid-cols-7 gap-1 text-center mb-2">
                        <div class="text-[10px] font-bold text-gray-400">日</div>
                        <div class="text-[10px] font-bold text-gray-400">一</div>
                        <div class="text-[10px] font-bold text-gray-400">二</div>
                        <div class="text-[10px] font-bold text-gray-400">三</div>
                        <div class="text-[10px] font-bold text-gray-400">四</div>
                        <div class="text-[10px] font-bold text-gray-400">五</div>
                        <div class="text-[10px] font-bold text-gray-400">六</div>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center"></div>
                </div>
                <!-- 運勢卡片 -->
                <div class="fortune-card rounded-3xl p-5 space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-red-600 font-bold text-sm">今日運勢</span>
                        <span class="text-[10px] px-2 py-1 bg-red-100 text-red-600 rounded-full font-bold">每日占卜</span>
                    </div>
                    <div id="fortune-text" class="text-gray-700 text-sm leading-relaxed font-medium">正在為您求籤...</div>
                    <div class="grid grid-cols-2 gap-2 mt-2">
                        <div class="bg-green-50 p-2 rounded-xl border border-green-100">
                            <span class="text-[10px] text-green-600 font-bold block">【宜】</span>
                            <span id="fortune-suit" class="text-[11px] text-green-800">讀書、會友</span>
                        </div>
                        <div class="bg-red-50 p-2 rounded-xl border border-red-100">
                            <span class="text-[10px] text-red-600 font-bold block">【忌】</span>
                            <span id="fortune-avoid" class="text-[11px] text-red-800">爭執、遠行</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 生活備忘錄區塊 -->
            <section id="section-memo" class="hidden space-y-4 animate-fade-in">
                <div class="flex bg-gray-100 p-1 rounded-xl">
                    <button onclick="switchSubTab('memo', 'edit')" id="memo-sub-edit" class="flex-1 py-2 text-xs font-bold rounded-lg sub-tab-active">新增備忘</button>
                    <button onclick="switchSubTab('memo', 'view')" id="memo-sub-view" class="flex-1 py-2 text-xs font-bold rounded-lg text-gray-500">查看清單</button>
                </div>
                <div id="memo-view-edit">
                    <textarea id="memo-input" placeholder="寫點什麼想保存的事..." rows="5" class="w-full p-4 bg-gray-50 rounded-2xl border-none text-sm outline-none resize-none mb-4"></textarea>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="clearMemoInput()" class="bg-gray-200 text-gray-600 py-4 rounded-2xl font-bold active:scale-95">一鍵清空</button>
                        <button onclick="saveMemo()" class="bg-blue-600 text-white py-4 rounded-2xl font-bold active:scale-95 shadow-lg shadow-blue-100">儲存備忘</button>
                    </div>
                </div>
                <div id="memo-view-view" class="hidden">
                    <div id="memo-list" class="space-y-4"></div>
                </div>
            </section>

            <!-- 個人電話簿區塊 -->
            <section id="section-contacts" class="hidden space-y-4 animate-fade-in">
                <div class="flex bg-gray-100 p-1 rounded-xl">
                    <button onclick="switchSubTab('contacts', 'edit')" id="contacts-sub-edit" class="flex-1 py-2 text-xs font-bold rounded-lg sub-tab-active">新增聯絡人</button>
                    <button onclick="switchSubTab('contacts', 'view')" id="contacts-sub-view" class="flex-1 py-2 text-xs font-bold rounded-lg text-gray-500">查看名單</button>
                </div>
                <div id="contacts-view-edit" class="space-y-4">
                    <input type="text" id="contact-name" placeholder="姓名" class="w-full p-4 bg-gray-50 rounded-xl border-none text-sm outline-none">
                    <input type="tel" id="contact-phone" placeholder="電話" class="w-full p-4 bg-gray-50 rounded-xl border-none text-sm outline-none">
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="clearContactInput()" class="bg-gray-200 text-gray-600 py-4 rounded-xl font-bold active:scale-95">一鍵清空</button>
                        <button onclick="saveContact()" class="bg-indigo-600 text-white py-4 rounded-xl font-bold active:scale-95 shadow-lg shadow-indigo-100">儲存資訊</button>
                    </div>
                </div>
                <div id="contacts-view-view" class="hidden">
                    <div id="contacts-list" class="space-y-3"></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- 核心變數 ---
        const MEMO_KEY = 'my_assistant_memos';
        const CONTACTS_KEY = 'my_assistant_contacts';

        // --- 全域 UI 切換 ---
        window.switchTab = (tab) => {
            const sections = ['calendar', 'memo', 'contacts'];
            sections.forEach(t => {
                const el = document.getElementById(`section-${t}`);
                const tabBtn = document.getElementById(`tab-${t}`);
                if (el) el.classList.add('hidden');
                if (tabBtn) tabBtn.classList.replace('tab-active', 'text-gray-400');
            });
            const targetEl = document.getElementById(`section-${tab}`);
            const targetBtn = document.getElementById(`tab-${tab}`);
            if (targetEl) targetEl.classList.remove('hidden');
            if (targetBtn) targetBtn.classList.replace('text-gray-400', 'tab-active');
        };

        window.switchSubTab = (p, v) => {
            const eBtn = document.getElementById(`${p}-sub-edit`), vBtn = document.getElementById(`${p}-sub-view`);
            const eA = document.getElementById(`${p}-view-edit`), vA = document.getElementById(`${p}-view-view`);
            if (!eBtn || !vBtn || !eA || !vA) return;

            if (v === 'edit') {
                eBtn.className = "flex-1 py-2 text-xs font-bold rounded-lg sub-tab-active";
                vBtn.className = "flex-1 py-2 text-xs font-bold rounded-lg text-gray-500";
                eA.classList.remove('hidden'); vA.classList.add('hidden');
            } else {
                vBtn.className = "flex-1 py-2 text-xs font-bold rounded-lg sub-tab-active";
                eBtn.className = "flex-1 py-2 text-xs font-bold rounded-lg text-gray-500";
                eA.classList.add('hidden'); vA.classList.remove('hidden');
                if(p === 'memo') renderMemos();
                if(p === 'contacts') renderContacts();
            }
        };

        // --- 清空功能 ---
        window.clearMemoInput = () => document.getElementById('memo-input').value = "";
        window.clearContactInput = () => {
            document.getElementById('contact-name').value = "";
            document.getElementById('contact-phone').value = "";
        };

        // --- 農曆算法 ---
        const lunarMonths = ["正月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "冬月", "臘月"];
        const lunarDays = ["初一", "初二", "初三", "初四", "初五", "初六", "初七", "初八", "初九", "初十", "十一", "十二", "十三", "十四", "十五", "十六", "十七", "十八", "十九", "廿十", "廿一", "廿二", "廿三", "廿四", "廿五", "廿六", "廿七", "廿八", "廿九", "三十"];
        
        function calculateLunar(year, month, day) {
            try {
                const baseDate = new Date(2024, 1, 10);
                const targetDate = new Date(year, month, day);
                const diffDays = Math.floor((targetDate - baseDate) / (24 * 3600 * 1000));
                let cycleDays = diffDays % 354; 
                if (cycleDays < 0) cycleDays += 354;
                return { month: lunarMonths[Math.floor(cycleDays / 29.5) % 12], day: lunarDays[Math.floor(cycleDays % 29.5) % 30] };
            } catch(e) {
                return { month: "正月", day: "初一" };
            }
        }

        // --- 生活備忘錄邏輯 ---
        window.saveMemo = () => {
            const input = document.getElementById('memo-input');
            const text = input.value.trim();
            if (!text) return;
            const memos = JSON.parse(localStorage.getItem(MEMO_KEY) || '[]');
            memos.unshift({ id: Date.now(), text, time: new Date().toLocaleString('zh-TW') });
            localStorage.setItem(MEMO_KEY, JSON.stringify(memos));
            input.value = "";
            switchSubTab('memo', 'view');
        };

        function renderMemos() {
            const list = document.getElementById('memo-list');
            const memos = JSON.parse(localStorage.getItem(MEMO_KEY) || '[]');
            list.innerHTML = memos.map(m => `
                <div class="p-5 bg-white rounded-2xl border-2 border-gray-100 shadow-sm animate-fade-in">
                    <p class="text-[15px] text-gray-800 font-medium leading-relaxed mb-4 whitespace-pre-wrap">${m.text}</p>
                    <div class="flex justify-between items-center pt-3 border-t border-gray-100">
                        <span class="time-tag">儲存：${m.time}</span>
                        <button onclick="deleteItem('memo', ${m.id})" class="btn-delete">刪除紀錄</button>
                    </div>
                </div>
            `).join('') || '<div class="py-20 text-center text-gray-300 text-xs font-bold">目前沒有備忘紀錄</div>';
        }

        // --- 個人電話簿邏輯 ---
        window.saveContact = () => {
            const nInput = document.getElementById('contact-name');
            const pInput = document.getElementById('contact-phone');
            const name = nInput.value.trim();
            const phone = pInput.value.trim();
            if (!name || !phone) return;
            const contacts = JSON.parse(localStorage.getItem(CONTACTS_KEY) || '[]');
            contacts.unshift({ id: Date.now(), name, phone });
            localStorage.setItem(CONTACTS_KEY, JSON.stringify(contacts));
            nInput.value = ""; pInput.value = "";
            switchSubTab('contacts', 'view');
        };

        function renderContacts() {
            const list = document.getElementById('contacts-list');
            const contacts = JSON.parse(localStorage.getItem(CONTACTS_KEY) || '[]');
            list.innerHTML = contacts.map(c => `
                <div class="flex justify-between items-center p-5 bg-indigo-50/40 rounded-2xl border-2 border-indigo-100 shadow-sm animate-fade-in">
                    <div>
                        <div class="text-base font-bold text-gray-900">${c.name}</div>
                        <div class="text-sm text-indigo-700 font-mono font-black mt-1 tracking-wide">${c.phone}</div>
                    </div>
                    <button onclick="deleteItem('contact', ${c.id})" class="btn-delete">刪除</button>
                </div>
            `).join('') || '<div class="py-20 text-center text-gray-300 text-xs font-bold">電話簿目前是空的</div>';
        }

        // --- 刪除功能 ---
        window.deleteItem = (type, id) => {
            if (!confirm("確定要刪除這筆紀錄嗎？操作不可還原。")) return;
            const key = type === 'memo' ? MEMO_KEY : CONTACTS_KEY;
            let items = JSON.parse(localStorage.getItem(key) || '[]');
            items = items.filter(i => i.id !== id);
            localStorage.setItem(key, JSON.stringify(items));
            type === 'memo' ? renderMemos() : renderContacts();
        };

        // --- 核心初始化函式 ---
        window.onload = function() {
            const now = new Date();
            const y = now.getFullYear(), m = now.getMonth(), d = now.getDate();
            
            // 更新時鐘
            const clockEl = document.getElementById('clock');
            const updateClock = () => { 
                if(clockEl) clockEl.textContent = new Date().toTimeString().split(' ')[0]; 
            };
            setInterval(updateClock, 1000);
            updateClock();

            // 更新日期與農曆
            document.getElementById('date-display').textContent = now.toLocaleDateString('zh-TW', { weekday: 'long', month: 'long', day: 'numeric' });
            const lun = calculateLunar(y, m, d);
            document.getElementById('lunar-display-top').textContent = `農曆 ${lun.month}${lun.day}`;
            document.getElementById('calendar-month').textContent = `${y}年 ${m + 1}月`;

            // 繪製日曆
            const grid = document.getElementById('calendar-grid');
            if(grid) {
                const firstDay = new Date(y, m, 1).getDay();
                const totalDays = new Date(y, m + 1, 0).getDate();
                let html = "";
                for (let i = 0; i < firstDay; i++) html += `<div></div>`;
                for (let i = 1; i <= totalDays; i++) {
                    const l = calculateLunar(y, m, i);
                    const isToday = i === d;
                    const activeClass = isToday ? 'bg-blue-600 text-white rounded-2xl shadow-lg scale-110 z-10' : 'text-gray-700 hover:bg-gray-100 rounded-xl';
                    html += `
                        <div class="calendar-day ${activeClass} py-1 transition-all">
                            <span class="text-xs font-bold">${i}</span>
                            <span class="text-[8px] ${isToday ? 'text-blue-100' : 'text-gray-400'}">${l.day}</span>
                        </div>
                    `;
                }
                grid.innerHTML = html;
            }

            // 更新運勢
            const fortunes = ["宜學習，今日靈感滿分。", "宜出遊，心情會豁然開朗。", "宜收納，整理環境帶動好運。", "宜沉思，適合計畫未來。", "宜運動，釋放壓力迎接好運。"];
            document.getElementById('fortune-text').textContent = fortunes[d % fortunes.length];
            
            // 初次渲染列表
            renderMemos();
            renderContacts();
        };
    </script>
</body>
</html>
